<!-- File: templates/edit_quest.html -->
{% extends "base.html" %}

{% block title %}クエスト編集{% endblock %}

{% block content %}
<style>
  .form-group {
    display: flex;
    align-items: flex-start;
    margin-bottom: 10px;
  }
  .form-group label {
    width: 100px; /* Adjust as needed for alignment */
    text-align: right;
    margin-right: 10px;
    padding-top: 5px; /* Align with input text vertically */
  }
  input[name="questname"] {
    width: 300px; /* Widens the questname input field */
  }
</style>

<h2>クエスト編集</h2>

<form method="post" action="{{ url_for('save_quest', quest_id=quest_id) }}">
  <label>ID: {{ quest.id if quest.id else 'New' }}</label><br>
  <div class="form-group">
    <label for="title-select">タイトル:</label>
    <select name="title" id="title-select" required>
      {% for jp_title, en_key in all_titles %}
        <option value="{{ en_key }}" {% if jp_title == quest_display_title %}selected{% endif %}>{{ jp_title }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <label for="level-select">レベル:</label>
    <select name="level" id="level-select" required>
      {% for l in all_levels %}
        <option value="{{ l }}" {% if l == quest.level %}selected{% endif %}>{{ l }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="form-group">
    <label>クエスト名:</label>
    <input type="text" name="questname" value="{{ quest.questname }}" required>
  </div>
  <br>
  <button type="submit">保存</button>
</form>

<hr>
{% if quest.id %}
<h3>このクエストの問題一覧</h3>
<form method="post">
  <input type="hidden" name="title" value="{{ title }}">
  <input type="hidden" name="level" value="{{ level }}">
  <table border="1" cellpadding="8">
    <tr>
      <th></th>
      <th>ID</th>
      <th>種類</th>
      <th>本文</th>
    </tr>
    {% for q in quest.questions %}
    <tr>
      <td><input type="radio" name="question_id" value="{{ q.id }}"></td>
      <td>{{ q.id }}</td>
      <td>{{ q.type }}</td>
      <td>{{ q.text[:30] }}...</td>
    </tr>
    {% endfor %}
  </table>
  <br>
  <button formaction="{{ url_for('edit_question_action', quest_id=quest.id) }}" onclick="return validateQuestionSelection()" formmethod="post">編集</button>
  <button formaction="{{ url_for('add_question', quest_id=quest.id) }}" formmethod="get">追加</button>
  <button formaction="{{ url_for('delete_question_action', quest_id=quest.id) }}" formmethod="post" onclick="return validateQuestionSelection() && confirm('本当に削除しますか？');">削除</button>
</form>
{% endif %}

<script>
function validateQuestionSelection() {
  const questId = document.querySelector('input[name="question_id"]:checked');
  if (!questId) {
    alert("問題を選択してください！");
    return false;
  }
  return true;
}
</script>
<p><a href="{{ url_for('manage_quests', title=title, level=level) }}" class="button">クエスト一覧に戻る</a></p>
{% endblock %}
