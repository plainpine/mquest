<!-- templates/progress.html - ç”Ÿå¾’ã®å­¦ç¿’çŠ¶æ³ç”»é¢ -->
{% extends "base.html" %}

{% block title %}å­¦ç¿’çŠ¶æ³{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .chart-container {
        width: 80%;
        max-width: 900px;
        margin: 40px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    .chart-selector .btn {
        margin-right: 5px;
    }
    .chart-view {
        display: none;
    }
    .chart-view.active {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<h1>ğŸ“˜ å­¦ç¿’é€²æ—çŠ¶æ³</h1>

<div class="text-center mb-4">
    <div class="btn-group chart-selector" role="group">
        <button type="button" class="btn btn-primary active" data-chart-type="weekly">éå»4é€±é–“</button>
        <button type="button" class="btn btn-secondary" data-chart-type="monthly">éå»3ãƒ¶æœˆ</button>
    </div>
</div>

<div id="chart-weekly" class="chart-view active">
    <div class="chart-container">
        <h2>éå»4é€±é–“ã®å­¦ç¿’è¨˜éŒ²</h2>
        {% if weekly_chart_data.labels %}
            <canvas id="weeklyChart"></canvas>
        {% else %}
            <p>éå»4é€±é–“ã®å­¦ç¿’è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>
</div>

<div id="chart-monthly" class="chart-view">
    <div class="chart-container">
        <h2>éå»3ãƒ¶æœˆã®å­¦ç¿’è¨˜éŒ²</h2>
        {% if monthly_chart_data.labels %}
            <canvas id="monthlyChart"></canvas>
        {% else %}
            <p>éå»3ãƒ¶æœˆã®å­¦ç¿’è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>
</div>

<h2>ã‚¯ã‚¨ã‚¹ãƒˆåˆ¶è¦‡çŠ¶æ³</h2>
<table border="1" cellpadding="6" cellspacing="0" style="margin: 20px auto;">
    <thead>
        <tr>
            <th>ç§‘ç›®</th>
            <th>ãƒ¬ãƒ™ãƒ«</th>
            <th>åˆ¶è¦‡ã‚¯ã‚¨ã‚¹ãƒˆæ•°</th>
        </tr>
    </thead>
    <tbody>
        {% for title, level, count in cleared %}
        <tr>
            <td>{{ title }}</td>
            <td>{{ level }}</td>
            <td>{{ count }}</td>
        </tr>
        {% endfor %}
        {% if not cleared %}
        <tr><td colspan="3">ã¾ã é”æˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>
        {% endif %}
    </tbody>
</table>

<br>
<a href="{{ url_for('dashboard_student') }}" class="button">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸æˆ»ã‚‹</a>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const buttons = document.querySelectorAll('.chart-selector button');
    buttons.forEach(button => {
        button.addEventListener('click', (event) => {
            const type = event.currentTarget.dataset.chartType;
            if (!type) return;

            // Toggle button styles
            document.querySelectorAll('.chart-selector button').forEach(btn => {
                btn.classList.remove('active', 'btn-primary');
                btn.classList.add('btn-secondary');
            });
            event.currentTarget.classList.add('active', 'btn-primary');
            event.currentTarget.classList.remove('btn-secondary');
            
            // Toggle chart visibility
            document.querySelectorAll('.chart-view').forEach(view => {
                view.classList.remove('active');
            });
            const newChartView = document.getElementById(`chart-${type}`);
            if (newChartView) {
                newChartView.classList.add('active');
            }
        });
    });

    const weeklyCtx = document.getElementById('weeklyChart');
    if (weeklyCtx) {
        const weeklyData = {{ weekly_chart_data|tojson }};
        new Chart(weeklyCtx, {
            type: 'line',
            data: {
                labels: weeklyData.labels,
                datasets: [
                    {
                        label: 'ã‚¯ã‚¨ã‚¹ãƒˆåˆ¶è¦‡å›æ•°',
                        data: weeklyData.cleared_count,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        yAxisID: 'y',
                    },
                    {
                        label: 'ã‚¯ã‚¨ã‚¹ãƒˆæŒ‘æˆ¦å›æ•°',
                        data: weeklyData.attempt_count,
                        borderColor: 'rgb(255, 99, 132)',
                        tension: 0.1,
                        yAxisID: 'y',
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1 // æ•´æ•°ã§è¡¨ç¤º
                        },
                        title: {
                            display: true,
                            text: 'å›æ•°'
                        }
                    }
                }
            }
        });
    }

    const monthlyCtx = document.getElementById('monthlyChart');
    if (monthlyCtx) {
        const monthlyData = {{ monthly_chart_data|tojson }};
        new Chart(monthlyCtx, {
            type: 'line',
            data: {
                labels: monthlyData.labels,
                datasets: [
                    {
                        label: 'ã‚¯ã‚¨ã‚¹ãƒˆåˆ¶è¦‡å›æ•°',
                        data: monthlyData.cleared_count,
                        borderColor: 'rgb(54, 162, 235)',
                        tension: 0.1,
                        yAxisID: 'y',
                    },
                    {
                        label: 'ã‚¯ã‚¨ã‚¹ãƒˆæŒ‘æˆ¦å›æ•°',
                        data: monthlyData.attempt_count,
                        borderColor: 'rgb(255, 159, 64)',
                        tension: 0.1,
                        yAxisID: 'y',
                    }
                ]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1 // æ•´æ•°ã§è¡¨ç¤º
                        },
                        title: {
                            display: true,
                            text: 'å›æ•°'
                        }
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}