<!-- templates/list_quests.html -->
{% extends "base.html" %}
{% block title %}Quest一覧{% endblock %}
{% block content %}
<h2>Quest一覧</h2>

<form method="get" action="{{ url_for('manage_quests') }}" style="margin-bottom: 1rem;">
  <label for="title-select">タイトルで絞り込み:</label>
  <select name="title" id="title-select">
    <option value="">すべて</option>
    {% for title in titles %}
      <option value="{{ title }}" {% if title == selected_title %}selected{% endif %}>{{ title }}</option>
    {% endfor %}
  </select>
  
  <label for="level-select" style="margin-left: 1rem;">レベルで絞り込み:</label>
  <select name="level" id="level-select">
    <option value="">すべて</option>
    {% for level in levels %}
      <option value="{{ level }}" {% if level == selected_level %}selected{% endif %}>{{ level }}</option>
    {% endfor %}
  </select>
  <button type="submit">絞り込み</button>
</form>

<form method="post" action="{{ url_for('handle_quest_action') }}" onsubmit="return validateQuestSelection()">
  <input type="hidden" name="title" value="{{ selected_title }}">
  <input type="hidden" name="level" value="{{ selected_level }}">
  <div style="margin-bottom: 1rem;">
    <button type="submit" name="action" value="edit">編集</button>
    <button type="button" onclick="location.href='{{ url_for('edit_quest', quest_id='new', title=selected_title, level=selected_level) }}'">追加</button>
    <button type="submit" name="action" value="delete" onclick="return confirm('本当に削除しますか？')">削除</button>
    <button type="submit" name="action" value="challenge">問題確認</button>
  </div>
  <table border="1" cellpadding="8">
    <thead>
      <tr>
        <th>選択</th>
        <th>ID</th>
        <th>タイトル</th>
        <th>レベル</th>
        <th>クエスト名</th>
      </tr>
    </thead>
    <tbody>
      {% for quest in quests %}
      <tr>
        <td><input type="radio" name="quest_id" value="{{ quest.id }}"></td>
        <td>{{ quest.id }}</td>
        <td>{{ quest.title }}</td>
        <td>{{ quest.level }}</td>
        <td>{{ quest.questname }}</td>
      </tr>
      {% else %}
      <tr><td colspan="6">対象のクエストがありません。</td></tr>
      {% endfor %}
    </tbody>
  </table>
  </form>
  <br>
  <a href="{{ url_for('dashboard_admin') }}" class="button">管理者ダッシュボードに戻る</a>
</form>

<script>
function validateQuestSelection() {
  const questId = document.querySelector('input[name="quest_id"]:checked');
  if (!questId) {
    alert("クエストを選択してください！");
    return false;
  }
  return true;
}
</script>
{% endblock %}

