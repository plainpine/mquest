{% extends "base.html" %}

{% block title %}生徒ダッシュボード{% endblock %}

{% block styles %}
{{ super() }}
<style>
  .map-container {
    margin-top: 2rem;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 8px;
    background-image: url('/static/maps/world.svg');
    background-size: 90%;
    background-position: center;
    background-repeat: no-repeat;
    background-color: rgba(255, 255, 255, 0.85); /* 背景を少し透過した白に */
  }
  .map-selector .btn {
      margin-right: 5px;
  }
  .map {
    display: none;
    margin-top: 1rem;
  }
  .map.active {
    display: block;
  }
  .map svg {
    width: 100%;
    height: auto;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  /* Default state for all paths */
  .map path {
    fill: #e0e0e0; /* 未制覇の国の色 (例: グレー) */
    stroke: #fff;
    stroke-width: 1px;
    transition: fill 0.3s ease-in-out;
  }
  .map path:hover {
    fill: #bdbdbd; /* ホバー時の色 */
    cursor: pointer;
  }
  /* Conquered states have a common border */
  .conquered {
    stroke: #d32f2f !important; /* 国境線 */
    stroke-width: 1.5px !important;
  }
  /* Tier colors based on attempts */
  .map .attempt-tier-1 { fill: #ffc107 !important; } /* 1-2 attempts */
  .map .attempt-tier-2 { fill: #ffa000 !important; } /* 3-4 attempts */
  .map .attempt-tier-3 { fill: #ff8f00 !important; } /* 5-6 attempts */
  .map .attempt-tier-4 { fill: #ff6f00 !important; } /* 7+ attempts */

  .map svg text {
    fill: #111 !important;
    color: #111 !important;
  }
</style>
{% endblock %}

{% block content %}
<h2>ようこそ、{{ session['nickname'] }}さん</h2>
<div class="dashboard-buttons" style="display: flex; flex-direction: column; gap: 1rem; max-width: 300px; margin: 2rem auto;">
    <a href="{{ url_for('select_title') }}" class="button" style="padding: 1rem; background-color: #4CAF50; color: white; text-align: center; text-decoration: none; border-radius: 8px;">クエストに挑戦する</a>
    <a href="{{ url_for('medals') }}" class="button" style="padding: 1rem; background-color: #2196F3; color: white; text-align: center; text-decoration: none; border-radius: 8px;">メダルを見る</a>
    <a href="{{ url_for('progress') }}" class="button" style="padding: 1rem; background-color: #f57c00; color: white; text-align: center; text-decoration: none; border-radius: 8px;">学習状況</a>
</div>

<div class="map-container text-center">
    <h3>制覇マップ</h3>
    <div class="map-selector btn-group" role="group">
      <button type="button" class="btn btn-primary active" data-map-type="europe">数学（エウロパ）</button>
      <button type="button" class="btn btn-secondary" data-map-type="americus">英語（アメリクス）</button>
      <button type="button" class="btn btn-secondary" data-map-type="zipangu">国語（ジパング）</button>
    </div>

    <div id="map-europe" class="map active">
        <object data="/static/maps/Europe.svg" type="image/svg+xml" width="100%" height="500">
            <p>数学（エウロパ）SVGの読み込みに失敗しました。パスを確認してください。</p>
        </object>
    </div>
    <div id="map-americus" class="map">
        <object data="/static/maps/Americus.svg" type="image/svg+xml" width="100%" height="500">
            <p>英語（アメリクス）SVGの読み込みに失敗しました。パスを確認してください。</p>
        </object>
    </div>
    <div id="map-zipangu" class="map">
        <object data="/static/maps/Zipangu.svg" type="image/svg+xml" width="100%" height="500">
            <p>国語（ジパング）SVGの読み込みに失敗しました。パスを確認してください。</p>
        </object>
    </div>
</div>
<div id="conquered-data" data-conquered='{{ conquered_quest_data|tojson }}' style="display: none;"></div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}